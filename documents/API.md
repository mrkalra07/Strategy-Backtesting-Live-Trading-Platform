# 📡 GoQuant API Documentation

This document describes the available REST and WebSocket endpoints in the GoQuant backend (FastAPI). It outlines request/response structures and usage examples.

---

## 🔁 Base URL

```
http://localhost:8000
```

---

## 🔧 Strategy Execution API

### POST `/strategy/run`

Runs a custom strategy using the uploaded OHLCV data and logic DSL.

### 🔸 Request Body (JSON)

```json
{
  "logic": "IF EMA_14 > EMA_50 AND RSI < 30 THEN BUY\nIF EMA_14 < EMA_50 THEN SELL",
  "nodes": [ ... ],
  "edges": [ ... ],
  "data": {
    "BTC-USDT": [
      { "timestamp": "2023-01-01T00:00:00Z", "open": 16800, "high": 17000, "low": 16700, "close": 16900, "volume": 12345 },
      ...
    ],
    "ETH-USDT": [ ... ]
  }
}
```

* **logic**: The DSL generated by the Visual Strategy Builder.
* **nodes**: The full list of strategy graph nodes (with types and properties).
* **edges**: Connections between nodes.
* **data**: Uploaded OHLCV data per symbol (normalized format).

### ✅ Response

```json
{
  "symbol_results": {
    "BTC-USDT": {
      "trades": [ { "entry_time": "...", "exit_time": "...", ... } ],
      "equity_curve": [ { "timestamp": "...", "equity": 10000.0 }, ... ],
      "drawdown": [ { "timestamp": "...", "drawdown": -2.5 }, ... ],
      "performance_metrics": {
        "pnl_percent": 12.3,
        "sharpe_ratio": 1.7,
        "max_drawdown_percent": -3.5,
        ...
      }
    },
    ...
  },
  "global_metrics": {
    "portfolio_pnl_percent": 14.6,
    "portfolio_cagr": 8.9,
    "portfolio_beta": 0.67,
    ...
  }
}
```

---

## 📁 Data Upload Flow

Data is uploaded via the frontend. CSV files are converted to JSON and embedded in the `data` field of `/strategy/run`. Each file corresponds to a symbol.

---

## 🟢 WebSocket (Live Trading Simulation)

### URL

```
ws://localhost:8000/ws/live_feed/{symbol}
```

Sends simulated OHLCV price data in real-time for a given symbol.

### 📤 Client subscribes

```
ws://localhost:8000/ws/live_feed/BTC-USDT
```

### 📥 Server pushes every second

```json
{
  "timestamp": "2024-01-01T12:00:00Z",
  "open": 27200,
  "high": 27320,
  "low": 27180,
  "close": 27280,
  "volume": 1040.25
}
```

---

## 📤 Manual Trade API (Live Trading)

### POST `/live/execute`

Executes a manual buy/sell order in live mode.

### 🔸 Request Body

```json
{
  "symbol": "BTC-USDT",
  "action": "BUY",
  "price": 27300,
  "quantity": 0.5
}
```

* **action**: Can be either `BUY` or `SELL`

### ✅ Response

```json
{
  "status": "executed",
  "position": {
    "side": "LONG",
    "entry_price": 27300,
    "quantity": 0.5
  }
}
```

---

## ⚠️ Error Handling

All endpoints return standardized errors:

```json
{
  "detail": "Invalid logic format"
}
```

---

## 🧪 Testing & Notes

* All indicators (EMA, RSI, MACD) are pre-computed during strategy evaluation.
* Conditions support: `AND`, `OR`, `>`, `<`, `>=`, `<=`, `=`, `!=`
* SL/TP logic is applied post-trade in both live and backtest modes.
* Multi-symbol logic and portfolio-level metrics are fully supported.
